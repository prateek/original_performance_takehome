# PRD: Original Performance Take‑Home (Local Optimization Plan)

## Objective

Minimize simulated cycle count for the kernel generated by
`KernelBuilder.build_kernel` (`perf_takehome.py`) while preserving correctness.

## Document Conventions

- `AGENTS.md` is the stable “how to work in this repo” guide (commands, repo map,
  invariants, integrity rules).
- `PRD.md` is the living “what to do next” plan + progress log that the
  automation loop (`./ralph-loop.sh`) follows.

## Constraints (Non‑Negotiable)

- **Do not modify anything under `tests/`.** Submissions that change the harness
  are invalid.
- Scoring uses the frozen simulator in `tests/frozen_problem.py`, so simulator
  changes in `problem.py` won’t count.
- Multicore is intentionally disabled: `N_CORES = 1`.

## How To Measure

- Authoritative: `python tests/submission_tests.py` (prints `CYCLES:`).
- Debug/trace loop:
  - `python perf_takehome.py Tests.test_kernel_trace`
  - `python watch_trace.py`

## Success Criteria

- Correctness: output values match the reference kernel for submission tests.
- Performance: improve over baseline (`147734` cycles) and track progress against
  the thresholds listed in `Readme.md` (e.g. `< 18532`, `< 2164`, `< 1487`).
- Stretch target: **200–500 cycles** (aggressive).

## Work Plan (Highest Priority First)

1. **VLIW packing:** improve `KernelBuilder.build` to pack independent slots into
   fewer instruction bundles while respecting `SLOT_LIMITS`.
2. **SIMD/vectorization:** use `vload`/`vstore` + `vbroadcast` + `valu` ops to
   process `VLEN=8` lanes at once where possible.
3. **Reduce memory traffic:** keep hot loop state in scratch; minimize
   load/store frequency to `mem` (only write back when required by correctness).
4. **Pipeline/unroll:** restructure the hash stages to reduce dependency chains
   and improve per‑cycle utilization.
5. **Documentation:** keep `AGENTS.md` and this PRD accurate for future runs.

## Repo Progress (Implementation)

- 2026-01-27: Added `AGENTS.md` (agent guide + repo integrity rules).
